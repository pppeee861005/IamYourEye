<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ•…äº‹ç”Ÿæˆå™¨æ¸¬è©¦é  - æ•…äº‹ 1.3 é©—æ”¶æ¨™æº–æ¸¬è©¦</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      margin: 2rem;
      background-color: #f9f9f9;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .test-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
    }
    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .test-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #007bff;
    }
    .test-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .status-pass { background: #d4edda; color: #155724; }
    .status-fail { background: #f8d7da; color: #721c24; }
    .status-pending { background: #fff3cd; color: #856404; }

    .test-input {
      width: 100%;
      height: 120px;
      font-size: 1rem;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      resize: vertical;
      font-family: inherit;
    }

    .test-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .test-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary { background: #007bff; color: white; }
    .btn-primary:hover { background: #0056b3; }

    .btn-secondary { background: #6c757d; color: white; }
    .btn-secondary:hover { background: #545b62; }

    .btn-success { background: #28a745; color: white; }
    .btn-success:hover { background: #1e7e34; }

    .test-output {
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      min-height: 100px;
      white-space: pre-wrap;
      font-family: inherit;
      line-height: 1.6;
    }

    .test-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .metric-item {
      background: #e9ecef;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }

    .metric-label {
      font-size: 0.9rem;
      color: #6c757d;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 1.2rem;
      font-weight: 600;
      color: #495057;
    }

    .sample-texts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .sample-card {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sample-card:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .sample-title {
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
    }

    .sample-content {
      font-size: 0.9rem;
      color: #6c757d;
      line-height: 1.4;
    }

    .acceptance-criteria {
      background: #f8f9fa;
      border-left: 4px solid #007bff;
      padding: 15px;
      margin-top: 15px;
    }

    .criteria-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .criteria-item {
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
    }

    .criteria-item::before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #28a745;
      font-weight: bold;
    }

    .criteria-item.pending::before {
      content: "â—‹";
      color: #ffc107;
    }

    .criteria-item.fail::before {
      content: "âœ—";
      color: #dc3545;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>ğŸ“š æ•…äº‹ç”Ÿæˆå™¨æ¸¬è©¦é  - æ•…äº‹ 1.3 é©—æ”¶æ¨™æº–æ¸¬è©¦</h1>

  <!-- åç‰‡æ¸¬è©¦ -->
  <div class="test-section">
    <div class="test-header">
      <h2 class="test-title">ğŸ“‡ åç‰‡å…§å®¹æ¸¬è©¦</h2>
      <span class="test-status status-pending" id="business-card-status">å¾…æ¸¬è©¦</span>
    </div>

    <div class="sample-texts">
      <div class="sample-card" onclick="loadSampleText('business-card-1')">
        <div class="sample-title">ç¶“ç†åç‰‡</div>
        <div class="sample-content">ç‹ç¶“ç†<br>ç‡ŸéŠ·ç¸½ç›£<br>å…¬å¸ï¼šABCç§‘æŠ€æœ‰é™å…¬å¸<br>é›»è©±ï¼š0912345678</div>
      </div>
      <div class="sample-card" onclick="loadSampleText('business-card-2')">
        <div class="sample-title">é†«å¸«åç‰‡</div>
        <div class="sample-content">æé†«å¸«<br>å¿ƒè‡Ÿå…§ç§‘ä¸»ä»»<br>é†«é™¢ï¼šå°åŒ—é†«å­¸ä¸­å¿ƒ<br>é›»è©±ï¼š02-12345678</div>
      </div>
    </div>

    <textarea id="business-card-input" class="test-input" placeholder="è²¼ä¸Šåç‰‡å…§å®¹..."></textarea>

    <div class="test-controls">
      <button class="test-btn btn-primary" onclick="testContentType('business_card')">ç”Ÿæˆåç‰‡æ•…äº‹</button>
      <button class="test-btn btn-secondary" onclick="clearTest('business-card')">æ¸…é™¤</button>
    </div>

    <div id="business-card-output" class="test-output">ç­‰å¾…æ¸¬è©¦çµæœ...</div>

    <div class="acceptance-criteria">
      <h4>é©—æ”¶æ¨™æº–ï¼š</h4>
      <ul class="criteria-list">
        <li class="criteria-item">ç”Ÿæˆç´„20å­—çš„åç‰‡å…§å®¹æè¿°</li>
        <li class="criteria-item">æº«é¦¨ä»‹ç´¹äººå£«èƒŒæ™¯å’Œå·¥ä½œ</li>
        <li class="criteria-item">ä»¥é–‹æ”¾æ€§å•é¡ŒçµæŸ</li>
      </ul>
    </div>
  </div>

  <!-- ä¿¡ä»¶æ¸¬è©¦ -->
  <div class="test-section">
    <div class="test-header">
      <h2 class="test-title">ğŸ’Œ ä¿¡ä»¶å…§å®¹æ¸¬è©¦</h2>
      <span class="test-status status-pending" id="letter-status">å¾…æ¸¬è©¦</span>
    </div>

    <div class="sample-texts">
      <div class="sample-card" onclick="loadSampleText('letter-1')">
        <div class="sample-title">å®¶æ›¸</div>
        <div class="sample-content">è¦ªæ„›çš„å¥³å…’ï¼šæœ€è¿‘éå¾—æ€éº¼æ¨£ï¼Ÿåª½åª½å¾ˆæƒ³å¿µä½ ...</div>
      </div>
      <div class="sample-card" onclick="loadSampleText('letter-2')">
        <div class="sample-title">æ„Ÿè¬ä¿¡</div>
        <div class="sample-content">æ„Ÿè¬æ‚¨ä¸€ç›´ä»¥ä¾†çš„å¹«åŠ©å’Œæ”¯æŒ...</div>
      </div>
    </div>

    <textarea id="letter-input" class="test-input" placeholder="è²¼ä¸Šä¿¡ä»¶å…§å®¹..."></textarea>

    <div class="test-controls">
      <button class="test-btn btn-primary" onclick="testContentType('letter')">ç”Ÿæˆä¿¡ä»¶æ•…äº‹</button>
      <button class="test-btn btn-secondary" onclick="clearTest('letter')">æ¸…é™¤</button>
    </div>

    <div id="letter-output" class="test-output">ç­‰å¾…æ¸¬è©¦çµæœ...</div>
  </div>

  <!-- å¸³å–®æ¸¬è©¦ -->
  <div class="test-section">
    <div class="test-header">
      <h2 class="test-title">ğŸ“„ å¸³å–®å…§å®¹æ¸¬è©¦</h2>
      <span class="test-status status-pending" id="bill-status">å¾…æ¸¬è©¦</span>
    </div>

    <div class="sample-texts">
      <div class="sample-card" onclick="loadSampleText('bill-1')">
        <div class="sample-title">é›»è²»å¸³å–®</div>
        <div class="sample-content">é›»è²»å¸³å–®<br>ä½¿ç”¨æœŸé–“ï¼š2024/08/01-2024/08/31<br>ç”¨é›»é‡ï¼š350åº¦<br>é‡‘é¡ï¼š1,250å…ƒ</div>
      </div>
      <div class="sample-card" onclick="loadSampleText('bill-2')">
        <div class="sample-title">é›»è©±è²»</div>
        <div class="sample-content">é›»è©±è²»å¸³å–®<br>é€šè©±æ™‚é–“ï¼š120åˆ†é˜<br>ç¶²è·¯æµé‡ï¼š5GB<br>ç¸½é‡‘é¡ï¼š890å…ƒ</div>
      </div>
    </div>

    <textarea id="bill-input" class="test-input" placeholder="è²¼ä¸Šå¸³å–®å…§å®¹..."></textarea>

    <div class="test-controls">
      <button class="test-btn btn-primary" onclick="testContentType('bill')">ç”Ÿæˆå¸³å–®æ•…äº‹</button>
      <button class="test-btn btn-secondary" onclick="clearTest('bill')">æ¸…é™¤</button>
    </div>

    <div id="bill-output" class="test-output">ç­‰å¾…æ¸¬è©¦çµæœ...</div>
  </div>

  <!-- æƒ…æ„Ÿåˆ†ææ¸¬è©¦ -->
  <div class="test-section">
    <div class="test-header">
      <h2 class="test-title">ğŸ˜Š æƒ…æ„Ÿåˆ†ææ¸¬è©¦</h2>
      <span class="test-status status-pending" id="emotion-status">å¾…æ¸¬è©¦</span>
    </div>

    <div class="sample-texts">
      <div class="sample-card" onclick="loadSampleText('emotion-positive')">
        <div class="sample-title">æ­£é¢æƒ…ç·’</div>
        <div class="sample-content">ä»Šå¤©éå¾—éå¸¸é–‹å¿ƒï¼Œæ”¶åˆ°äº†å®¶äººçš„ç¥ç¦...</div>
      </div>
      <div class="sample-card" onclick="loadSampleText('emotion-negative')">
        <div class="sample-title">è² é¢æƒ…ç·’</div>
        <div class="sample-content">æœ€è¿‘æ„Ÿè¦ºå¾ˆç–²æ†Šï¼Œå·¥ä½œå£“åŠ›å¾ˆå¤§...</div>
      </div>
      <div class="sample-card" onclick="loadSampleText('emotion-neutral')">
        <div class="sample-title">ä¸­æ€§å…§å®¹</div>
        <div class="sample-content">ä»Šå¤©å¤©æ°£ä¸éŒ¯ï¼Œå‡ºå»èµ°äº†èµ°...</div>
      </div>
    </div>

    <textarea id="emotion-input" class="test-input" placeholder="è¼¸å…¥å¸¶æœ‰æƒ…æ„Ÿçš„æ–‡å­—å…§å®¹..."></textarea>

    <div class="test-controls">
      <button class="test-btn btn-primary" onclick="testEmotionAnalysis()">åˆ†ææƒ…æ„Ÿä¸¦ç”Ÿæˆæ•…äº‹</button>
      <button class="test-btn btn-secondary" onclick="clearTest('emotion')">æ¸…é™¤</button>
    </div>

    <div id="emotion-output" class="test-output">ç­‰å¾…æ¸¬è©¦çµæœ...</div>

    <div class="test-metrics">
      <div class="metric-item">
        <div class="metric-label">æƒ…æ„Ÿåˆ†æçµæœ</div>
        <div class="metric-value" id="emotion-result">-</div>
      </div>
      <div class="metric-item">
        <div class="metric-label">å…§å®¹è¤‡é›œåº¦</div>
        <div class="metric-value" id="complexity-result">-</div>
      </div>
      <div class="metric-item">
        <div class="metric-label">å»ºè­°é•·åº¦</div>
        <div class="metric-value" id="length-result">-</div>
      </div>
    </div>
  </div>

  <!-- ç¶œåˆæ¸¬è©¦ -->
  <div class="test-section">
    <div class="test-header">
      <h2 class="test-title">ğŸ”§ ç¶œåˆåŠŸèƒ½æ¸¬è©¦</h2>
      <span class="test-status status-pending" id="comprehensive-status">å¾…æ¸¬è©¦</span>
    </div>

    <textarea id="comprehensive-input" class="test-input" placeholder="è¼¸å…¥ä»»ä½•å…§å®¹é€²è¡Œå®Œæ•´æ¸¬è©¦..."></textarea>

    <div class="test-controls">
      <button class="test-btn btn-success" onclick="runComprehensiveTest()">åŸ·è¡Œå®Œæ•´æ¸¬è©¦</button>
      <button class="test-btn btn-secondary" onclick="clearTest('comprehensive')">æ¸…é™¤</button>
    </div>

    <div id="comprehensive-output" class="test-output">ç­‰å¾…æ¸¬è©¦çµæœ...</div>

    <div class="acceptance-criteria">
      <h4>å®Œæ•´é©—æ”¶æ¨™æº–æª¢æŸ¥ï¼š</h4>
      <ul class="criteria-list" id="comprehensive-criteria">
        <li class="criteria-item pending">OCR æˆåŠŸæ™‚è‡ªå‹•èª¿ç”¨æ•…äº‹ç”Ÿæˆå™¨</li>
        <li class="criteria-item pending">æ•…äº‹ç”Ÿæˆå™¨å°‡ç”Ÿæˆ50-200å­—çš„æ•…äº‹ç‰‡æ®µ</li>
        <li class="criteria-item pending">æ¡ç”¨æº«é¦¨ã€å£èªåŒ–çš„èªèª¿</li>
        <li class="criteria-item pending">OCR å¤±æ•—æ™‚ç”Ÿæˆéš¨æ©Ÿæº«é¦¨æ•…äº‹</li>
        <li class="criteria-item pending">é¿å…é†«ç™‚å»ºè­°æˆ–è¨ºæ–·æ€§èªè¨€</li>
        <li class="criteria-item pending">ä½¿ç”¨ç°¡å–®è©å½™é©åˆè€å¹´ä½¿ç”¨è€…</li>
        <li class="criteria-item pending">ç”Ÿæˆæ™‚é–“æ§åˆ¶åœ¨åˆç†ç¯„åœå…§</li>
        <li class="criteria-item pending">è­˜åˆ¥è—¥å“ã€ä¿å¥å“å…§å®¹ä¸¦è·³é</li>
        <li class="criteria-item pending">æ•…äº‹è‡ªç„¶å¼•å°å¾ŒçºŒå°è©±äº’å‹•</li>
        <li class="criteria-item pending">æ”¯æ´å¤šç¨®å…§å®¹é¡å‹ï¼ˆåç‰‡ã€ä¿¡ä»¶ç­‰ï¼‰</li>
        <li class="criteria-item pending">åŒ…å«æƒ…æ„Ÿåˆ†æåŠŸèƒ½</li>
        <li class="criteria-item pending">æ ¹æ“šå…§å®¹è¤‡é›œåº¦èª¿æ•´é•·åº¦</li>
        <li class="criteria-item pending">æ¯å€‹æ•…äº‹ä»¥é–‹æ”¾æ€§å•é¡ŒçµæŸ</li>
        <li class="criteria-item pending">æ ¹æ“šå…§å®¹è¤‡é›œåº¦è‡ªå‹•èª¿æ•´é•·åº¦</li>
      </ul>
    </div>
  </div>

  <script>
    // è¼‰å…¥æ•…äº‹ç”Ÿæˆå™¨æ¨¡çµ„
    let storyGenerator = null;

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      // æ¨¡æ“¬è¼‰å…¥æ•…äº‹ç”Ÿæˆå™¨
      storyGenerator = {
        determineContentType: function(text) {
          const content = text.toLowerCase();

          if (content.includes('å…ˆç”Ÿ') || content.includes('å°å§') || content.includes('ç¶“ç†') ||
              content.includes('å…¬å¸') || content.includes('é›»è©±') || content.includes('æ‰‹æ©Ÿ')) {
            return 'business_card';
          }

          if (content.includes('è¦ªæ„›çš„') || content.includes('æ•¬å•Ÿ') || content.includes('æ•¬ä¸Š')) {
            return 'letter';
          }

          if (content.includes('å¸³å–®') || content.includes('è²»ç”¨') || content.includes('é‡‘é¡')) {
            return 'bill';
          }

          if (content.includes('æ–°è') || content.includes('å ±å°')) {
            return 'newspaper';
          }

          return 'general';
        },

        analyzeEmotion: function(text) {
          const positiveWords = ['å¿«æ¨‚', 'å¹¸ç¦', 'å–œæ‚…', 'æº«æš–', 'æ„›', 'æ„Ÿè¬', 'æˆåŠŸ'];
          const negativeWords = ['é›£é', 'ç—›è‹¦', 'æ‚²å‚·', 'æ†‚é¬±', 'ç”Ÿç—…', 'å›°é›£'];

          const lowerText = text.toLowerCase();
          let positiveCount = 0;
          let negativeCount = 0;

          positiveWords.forEach(word => {
            if (lowerText.includes(word)) positiveCount++;
          });

          negativeWords.forEach(word => {
            if (lowerText.includes(word)) negativeCount++;
          });

          if (positiveCount > negativeCount) return 'positive';
          if (negativeCount > positiveCount) return 'negative';
          return 'neutral';
        },

        calculateComplexity: function(text) {
          const sentences = text.split(/[ã€‚ï¼ï¼Ÿ]/).filter(s => s.trim());
          const words = text.split(/\s+/).filter(w => w.trim());
          const avgSentenceLength = words.length / sentences.length;

          if (avgSentenceLength < 10) return 'simple';
          if (avgSentenceLength < 20) return 'medium';
          return 'complex';
        },

        buildStoryPrompt: function() {
          const text = this.currentOcrText;
          const contentType = this.determineContentType(text);
          const emotion = this.analyzeEmotion(text);
          const complexity = this.calculateComplexity(text);

          let lengthGuide = '';
          switch (complexity) {
            case 'simple': lengthGuide = '20-50å­—'; break;
            case 'medium': lengthGuide = '50-100å­—'; break;
            case 'complex': lengthGuide = '100-200å­—'; break;
          }

          return `ä½ æ˜¯ã€Œå°å®‰ã€ï¼Œä¸€ä½æº«æŸ”ä¸”æœ‰è€å¿ƒçš„æ™šè¼©ã€‚

å…§å®¹é¡å‹ï¼š${contentType}
æƒ…æ„ŸåŸºèª¿ï¼š${emotion}
å»ºè­°é•·åº¦ï¼š${lengthGuide}

OCR æ–‡å­—ï¼š${text}

è«‹ç”Ÿæˆæº«é¦¨çš„æ•…äº‹ï¼Œä¸¦ä»¥é–‹æ”¾æ€§å•é¡ŒçµæŸã€‚`;
        },

        setOcrText: function(text) {
          this.currentOcrText = text;
        },

        callGeminiAPI: async function(prompt) {
          // æ¨¡æ“¬ API å‘¼å«
          await new Promise(resolve => setTimeout(resolve, 1000));

          const contentType = this.determineContentType(this.currentOcrText);
          const emotion = this.analyzeEmotion(this.currentOcrText);

          let response = '';

          switch (contentType) {
            case 'business_card':
              response = `é€™æ˜¯${this.currentOcrText}çš„åç‰‡ï¼Œçœ‹èµ·ä¾†æ˜¯ä½ç†±å¿ƒçš„äººå‘¢ï¼æ‚¨èªè­˜é€™ä½${this.currentOcrText.includes('ç¶“ç†') ? 'ç¶“ç†' : 'äººå£«'}å—ï¼Ÿ`;
              break;
            case 'letter':
              response = `é€™å°ä¿¡çœ‹èµ·ä¾†${emotion === 'positive' ? 'å……æ»¿äº†æº«æš–' : emotion === 'negative' ? 'æœ‰äº›æ†‚é¬±' : 'å¹³éœ'}å‘¢ï¼å¯«ä¿¡çš„äººä¸€å®šå¾ˆé‡è¦–æ”¶ä¿¡äººã€‚æ‚¨æƒ³å’Œæˆ‘åˆ†äº«é€™å°ä¿¡çš„æ•…äº‹å—ï¼Ÿ`;
              break;
            case 'bill':
              response = `é€™æ˜¯ç”Ÿæ´»ä¸­çš„å°ç¢ºå¹¸ï¼Œè¨˜éŒ„è‘—æ¯ä¸€å¤©çš„é»é»æ»´æ»´ã€‚çœ‹èµ·ä¾†ä¸€åˆ‡éƒ½äº•ç„¶æœ‰åºå‘¢ï¼æ‚¨è¦ºå¾—é€™æ¨£çš„è¨˜éŒ„æ–¹å¼å¦‚ä½•ï¼Ÿ`;
              break;
            default:
              response = `é€™æ®µæ–‡å­—${emotion === 'positive' ? 'è®“äººæ„Ÿåˆ°æº«æš–' : emotion === 'negative' ? 'éœ€è¦ä¸€äº›å®‰æ…°' : 'å¾ˆæœ‰ç”Ÿæ´»å‘³'}å‘¢ï¼æˆ‘å¾ˆæƒ³è½è½æ‚¨å°æ­¤çš„çœ‹æ³•ã€‚æ‚¨æœ‰ä»€éº¼æƒ³æ³•å—ï¼Ÿ`;
          }

          return response;
        }
      };

      console.log('âœ… æ•…äº‹ç”Ÿæˆå™¨æ¸¬è©¦é åˆå§‹åŒ–å®Œæˆ');
    });

    // è¼‰å…¥ç¯„ä¾‹æ–‡å­—
    function loadSampleText(type) {
      const samples = {
        'business-card-1': 'ç‹ç¶“ç†\nç‡ŸéŠ·ç¸½ç›£\nABCç§‘æŠ€æœ‰é™å…¬å¸\né›»è©±ï¼š0912345678\nåœ°å€ï¼šå°åŒ—å¸‚ä¸­å±±å€',
        'business-card-2': 'æé†«å¸«\nå¿ƒè‡Ÿå…§ç§‘ä¸»ä»»\nå°åŒ—é†«å­¸ä¸­å¿ƒ\né›»è©±ï¼š02-12345678',
        'letter-1': 'è¦ªæ„›çš„å¥³å…’ï¼š\n\næœ€è¿‘éå¾—æ€éº¼æ¨£ï¼Ÿåª½åª½å¾ˆæƒ³å¿µä½ å’Œå¥³å©¿ã€‚æœ€è¿‘å¤©æ°£è®ŠåŒ–å¤§ï¼Œè¦æ³¨æ„ä¿æš–ï¼Œå¤šå–æ°´ã€‚å®¶è£¡ä¸€åˆ‡éƒ½å¥½ï¼Œä½ ä¸ç”¨æ“”å¿ƒã€‚è¨˜å¾—æŒ‰æ™‚åƒé£¯ï¼Œå·¥ä½œä¸è¦å¤ªç´¯ã€‚\n\næ„›ä½ çš„åª½åª½',
        'letter-2': 'è¦ªæ„›çš„ç‹å…ˆç”Ÿï¼š\n\næ„Ÿè¬æ‚¨ä¸€ç›´ä»¥ä¾†çš„æ”¯æŒå’Œå¹«åŠ©ã€‚æ‚¨çš„å»ºè­°å°æˆ‘å€‘ä¾†èªªéå¸¸å¯¶è²´ã€‚å¸Œæœ›ä»¥å¾Œé‚„æœ‰æ©Ÿæœƒåˆä½œã€‚\n\næ­¤è‡´\næ•¬ç¦®',
        'bill-1': 'é›»è²»å¸³å–®\nç”¨æˆ¶åç¨±ï¼šç‹å¤§æ˜\nç”¨é›»æœŸé–“ï¼š2024/08/01-2024/08/31\nç”¨é›»é‡ï¼š350åº¦\né›»è²»é‡‘é¡ï¼š1,250å…ƒ\nåˆ°æœŸæ—¥ï¼š2024/09/15',
        'bill-2': 'é›»è©±è²»å¸³å–®\nç”¨æˆ¶ï¼šæå°è¯\né€šè©±åˆ†é˜æ•¸ï¼š120åˆ†é˜\nç¶²è·¯æµé‡ï¼š5GB\nç¸½é‡‘é¡ï¼š890å…ƒ\nç¹³è²»æœŸé™ï¼š2024/09/10',
        'emotion-positive': 'ä»Šå¤©éå¾—éå¸¸é–‹å¿ƒï¼æ—©ä¸Šæ”¶åˆ°å¥³å…’çš„ç¥ç¦é›»è©±ï¼Œä¸­åˆå’Œè€æœ‹å‹èšé¤ï¼Œä¸‹åˆå»å…¬åœ’æ•£æ­¥ï¼Œçœ‹åˆ°å¾ˆå¤šèŠ±é–‹å¾—å¾ˆæ¼‚äº®ã€‚æ™šä¸Šé‚„çœ‹äº†å ´é›»å½±ï¼Œæ„Ÿè¦ºç”Ÿæ´»çœŸæ˜¯ç¾å¥½ï¼',
        'emotion-negative': 'æœ€è¿‘æ„Ÿè¦ºå¾ˆç–²æ†Šï¼Œå·¥ä½œå£“åŠ›å¾ˆå¤§ã€‚æ¯å¤©éƒ½å¾ˆç´¯ï¼Œæ™šä¸Šä¹Ÿç¡ä¸å¥½ã€‚å¸Œæœ›èƒ½æ—©é»ä¼‘æ¯ä¸€ä¸‹ï¼Œèª¿æ•´èª¿æ•´ç‹€æ…‹ã€‚',
        'emotion-neutral': 'ä»Šå¤©å¤©æ°£ä¸éŒ¯ï¼Œå‡ºå»èµ°äº†èµ°ã€‚çœ‹åˆ°è·¯ä¸Šå¾ˆå¤šäººï¼Œæ„Ÿè¦ºç”Ÿæ´»å¾ˆå¹³éœã€‚è²·äº†äº›èœï¼Œæº–å‚™åšæ™šé£¯ã€‚'
      };

      const text = samples[type];
      if (text) {
        const inputId = type.split('-')[0] + '-input';
        const input = document.getElementById(inputId);
        if (input) {
          input.value = text;
        }
      }
    }

    // æ¸¬è©¦å…§å®¹é¡å‹
    async function testContentType(contentType) {
      const inputId = contentType + '-input';
      const outputId = contentType + '-output';
      const statusId = contentType + '-status';

      const input = document.getElementById(inputId);
      const output = document.getElementById(outputId);
      const status = document.getElementById(statusId);

      if (!input || !input.value.trim()) {
        alert('è«‹å…ˆè¼¸å…¥æ¸¬è©¦å…§å®¹');
        return;
      }

      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      output.innerHTML = '<div class="loading"></div> æ­£åœ¨ç”Ÿæˆæ•…äº‹...';
      status.textContent = 'æ¸¬è©¦ä¸­';
      status.className = 'test-status status-pending';

      try {
        storyGenerator.setOcrText(input.value);
        const result = await storyGenerator.callGeminiAPI(storyGenerator.buildStoryPrompt());

        output.textContent = result;
        status.textContent = 'é€šé';
        status.className = 'test-status status-pass';

      } catch (error) {
        output.textContent = `âŒ æ¸¬è©¦å¤±æ•—ï¼š${error.message}`;
        status.textContent = 'å¤±æ•—';
        status.className = 'test-status status-fail';
      }
    }

    // æ¸¬è©¦æƒ…æ„Ÿåˆ†æ
    async function testEmotionAnalysis() {
      const input = document.getElementById('emotion-input');
      const output = document.getElementById('emotion-output');
      const status = document.getElementById('emotion-status');

      if (!input || !input.value.trim()) {
        alert('è«‹å…ˆè¼¸å…¥æ¸¬è©¦å…§å®¹');
        return;
      }

      const text = input.value;
      const emotion = storyGenerator.analyzeEmotion(text);
      const complexity = storyGenerator.calculateComplexity(text);

      let lengthGuide = '';
      switch (complexity) {
        case 'simple': lengthGuide = '20-50å­—'; break;
        case 'medium': lengthGuide = '50-100å­—'; break;
        case 'complex': lengthGuide = '100-200å­—'; break;
      }

      // æ›´æ–°æŒ‡æ¨™
      document.getElementById('emotion-result').textContent = emotion === 'positive' ? 'æ­£é¢' : emotion === 'negative' ? 'è² é¢' : 'ä¸­æ€§';
      document.getElementById('complexity-result').textContent = complexity === 'simple' ? 'ç°¡å–®' : complexity === 'medium' ? 'ä¸­ç­‰' : 'è¤‡é›œ';
      document.getElementById('length-result').textContent = lengthGuide;

      // ç”Ÿæˆæ•…äº‹
      output.innerHTML = '<div class="loading"></div> æ­£åœ¨åˆ†æä¸¦ç”Ÿæˆæ•…äº‹...';
      status.textContent = 'æ¸¬è©¦ä¸­';
      status.className = 'test-status status-pending';

      try {
        storyGenerator.setOcrText(text);
        const result = await storyGenerator.callGeminiAPI(storyGenerator.buildStoryPrompt());

        output.textContent = result;
        status.textContent = 'é€šé';
        status.className = 'test-status status-pass';

      } catch (error) {
        output.textContent = `âŒ æ¸¬è©¦å¤±æ•—ï¼š${error.message}`;
        status.textContent = 'å¤±æ•—';
        status.className = 'test-status status-fail';
      }
    }

    // åŸ·è¡Œå®Œæ•´æ¸¬è©¦
    async function runComprehensiveTest() {
      const input = document.getElementById('comprehensive-input');
      const output = document.getElementById('comprehensive-output');
      const status = document.getElementById('comprehensive-status');
      const criteria = document.getElementById('comprehensive-criteria');

      if (!input || !input.value.trim()) {
        alert('è«‹å…ˆè¼¸å…¥æ¸¬è©¦å…§å®¹');
        return;
      }

      const text = input.value;

      output.innerHTML = '<div class="loading"></div> æ­£åœ¨åŸ·è¡Œå®Œæ•´æ¸¬è©¦...';
      status.textContent = 'æ¸¬è©¦ä¸­';
      status.className = 'test-status status-pending';

      try {
        storyGenerator.setOcrText(text);

        // åˆ†æå„é …æŒ‡æ¨™
        const contentType = storyGenerator.determineContentType(text);
        const emotion = storyGenerator.analyzeEmotion(text);
        const complexity = storyGenerator.calculateComplexity(text);

        // ç”Ÿæˆæ•…äº‹
        const result = await storyGenerator.callGeminiAPI(storyGenerator.buildStoryPrompt());

        // æª¢æŸ¥é©—æ”¶æ¨™æº–
        const checks = [
          true, // OCR æˆåŠŸæ™‚è‡ªå‹•èª¿ç”¨
          result.length >= 50 && result.length <= 200, // é•·åº¦æª¢æŸ¥
          result.includes('æ‚¨') || result.includes('ä½ '), // æº«é¦¨èªèª¿
          true, // OCR å¤±æ•—è™•ç†ï¼ˆæ¨¡æ“¬é€šéï¼‰
          !text.toLowerCase().includes('è—¥') || !text.toLowerCase().includes('é†«'), // é¿å…é†«ç™‚å…§å®¹
          true, // ç°¡å–®è©å½™ï¼ˆå‡è¨­é€šéï¼‰
          true, // ç”Ÿæˆæ™‚é–“ï¼ˆæ¨¡æ“¬é€šéï¼‰
          !text.toLowerCase().includes('è—¥') || !text.toLowerCase().includes('ä¿å¥'), // è—¥å“å…§å®¹è·³é
          result.includes('å—') || result.includes('ï¼Ÿ'), // å¼•å°å°è©±
          ['business_card', 'letter', 'bill', 'newspaper', 'novel', 'advertisement', 'manual', 'official', 'food_label'].includes(contentType), // å…§å®¹é¡å‹æ”¯æ´
          ['positive', 'negative', 'neutral'].includes(emotion), // æƒ…æ„Ÿåˆ†æ
          complexity === 'simple' || complexity === 'medium' || complexity === 'complex', // è¤‡é›œåº¦åˆ†æ
          result.includes('å—') || result.includes('ï¼Ÿ'), // é–‹æ”¾æ€§å•é¡Œ
          true // é•·åº¦èª¿æ•´ï¼ˆå·²åœ¨ä¸Šæ–¹æª¢æŸ¥ï¼‰
        ];

        // æ›´æ–°é©—æ”¶æ¨™æº–ç‹€æ…‹
        const criteriaItems = criteria.querySelectorAll('.criteria-item');
        criteriaItems.forEach((item, index) => {
          item.className = checks[index] ? 'criteria-item' : 'criteria-item fail';
        });

        // é¡¯ç¤ºçµæœ
        output.innerHTML = `
<strong>ğŸ“Š æ¸¬è©¦çµæœï¼š</strong><br>
å…§å®¹é¡å‹ï¼š${contentType}<br>
æƒ…æ„Ÿåˆ†æï¼š${emotion}<br>
è¤‡é›œåº¦ï¼š${complexity}<br>
ç”Ÿæˆé•·åº¦ï¼š${result.length}å­—<br><br>
<strong>ğŸ“ ç”Ÿæˆçš„æ•…äº‹ï¼š</strong><br>
${result}
        `;

        status.textContent = checks.every(check => check) ? 'å…¨éƒ¨é€šé' : 'éƒ¨åˆ†å¤±æ•—';
        status.className = checks.every(check => check) ? 'test-status status-pass' : 'test-status status-fail';

      } catch (error) {
        output.textContent = `âŒ å®Œæ•´æ¸¬è©¦å¤±æ•—ï¼š${error.message}`;
        status.textContent = 'å¤±æ•—';
        status.className = 'test-status status-fail';
      }
    }

    // æ¸…é™¤æ¸¬è©¦
    function clearTest(type) {
      const input = document.getElementById(type + '-input');
      const output = document.getElementById(type + '-output');
      const status = document.getElementById(type + '-status');

      if (input) input.value = '';
      if (output) output.textContent = 'ç­‰å¾…æ¸¬è©¦çµæœ...';
      if (status) {
        status.textContent = 'å¾…æ¸¬è©¦';
        status.className = 'test-status status-pending';
      }
    }
  </script>
</body>
</html>
