<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>è€èŠ±çœ¼æ•‘æ˜Ÿ</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Tesseract.js for OCR -->
    <script src="https://unpkg.com/tesseract.js@5.0.4/dist/tesseract.min.js"></script>

    <!-- å„ªå…ˆè¼‰å…¥ Gemini èŠå¤©ç›¸é—œè…³æœ¬ -->
    <script src="./js/config.js"></script> <!-- config.js ä¸å†æ˜¯æ¨¡çµ„ -->
    <script src="./js/env-loader.js"></script> <!-- å¼•å…¥ env-loader.js -->
    <script src="./js/gemini-chat.js"></script> <!-- Gemini AI èŠå¤©åŠŸèƒ½ -->

    <!-- å»¶é²è¼‰å…¥æ¨¡çµ„è…³æœ¬ï¼Œé¿å…æ™‚æ©Ÿè¡çª -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="./js/story-generator.js"></script>
</head>
<body>
    <!-- ä¸»å®¹å™¨ - èªç¾©åŒ–HTMLçµæ§‹ -->
    <main class="app-container" role="main">
        
        <!-- AIå•å€™å€åŸŸ -->
        <header class="greeting-section">
            <h1 class="app-title">ğŸ˜Š è€èŠ±çœ¼æ•‘æ˜Ÿ</h1>
            <div class="ai-greeting" id="ai-greeting">
                <div class="greeting-text">æ‚¨å¥½ï¼æˆ‘æ˜¯å°å®‰ï¼Œæ‚¨çš„è²¼å¿ƒåŠ©æ‰‹ ğŸ˜Š</div>
                <div class="greeting-question">è«‹å•æˆ‘è©²æ€éº¼ç¨±å‘¼æ‚¨å‘¢ï¼Ÿ</div>
                <div class="user-preference" id="user-preference">
                    <button class="preference-btn" id="grandpa-btn" aria-label="é¸æ“‡çˆºçˆºç¨±è¬‚">çˆºçˆº</button>
                    <button class="preference-btn" id="grandma-btn" aria-label="é¸æ“‡å¥¶å¥¶ç¨±è¬‚">å¥¶å¥¶</button>
                </div>
            </div>
        </header>

        <!-- è§’è‰²æŒ‡ç¤ºå™¨ -->
        <div id="role-indicator" class="role-indicator" style="display: none;">
            <div class="role-indicator-content">
                <span class="role-icon">ğŸ˜Š</span>
                <span class="role-name">å°å®‰æ­£åœ¨å”åŠ©æ‚¨</span>
            </div>
        </div>


        <!-- æ ¸å¿ƒåŠŸèƒ½å…¥å£å€åŸŸ -->
        <section class="main-interactions">
            <div class="interactions-container">
                <!-- ä¸Šå‚³ç…§ç‰‡åŠŸèƒ½ -->
                <div class="interaction-item">
                    <label for="photo-upload" class="primary-btn" role="button" tabindex="0" aria-label="ä¸Šå‚³ç…§ç‰‡é€²è¡Œæ–‡å­—è­˜åˆ¥">
                        ğŸ“· ä¸Šå‚³ç…§ç‰‡
                        <input type="file" id="photo-upload" class="file-input" accept="image/*" aria-describedby="upload-desc">
                    </label>
                    <p class="interaction-desc" id="upload-desc">ä¸Šå‚³åœ–ç‰‡ï¼Œå°å®‰æœƒå¹«æ‚¨è­˜åˆ¥æ–‡å­—å…§å®¹</p>
                </div>



                <!-- æ•…äº‹ç”Ÿæˆå™¨åŠŸèƒ½ -->
                <div class="interaction-item">
                    <label for="story-text-input" class="input-label">ğŸ“– æ•…äº‹ç”Ÿæˆå™¨</label>
                    <textarea
                        id="story-text-input"
                        class="text-input"
                        placeholder="è¼¸å…¥æ–‡å­—å…§å®¹ï¼Œå°å®‰æœƒç‚ºæ‚¨ç”Ÿæˆæº«é¦¨æ•…äº‹..."
                        rows="3"
                        maxlength="1000"
                        aria-describedby="story-desc">
                    </textarea>
                    <p class="interaction-desc" id="story-desc">è®“å°å®‰å°‡è¤‡é›œæ–‡å­—è½‰åŒ–ç‚ºæº«é¦¨æ˜“æ‡‚çš„æ•…äº‹</p>
                    <button class="primary-btn" id="generate-story-btn" aria-label="ç”Ÿæˆæ•…äº‹">
                        ğŸ“– ç”Ÿæˆæ•…äº‹
                    </button>
                </div>
            </div>
        </section>

        <!-- OCR çµæœé¡¯ç¤ºå€åŸŸ -->
        <section id="ocr-result-area" class="ocr-result-area" style="display: none;" aria-live="polite">
            <div class="ocr-result-header">
                <h3>ğŸ“ è­˜åˆ¥çµæœ</h3>
                <button id="ocr-result-close" class="close-btn" aria-label="é—œé–‰è­˜åˆ¥çµæœ">âœ•</button>
            </div>
            <div class="ocr-result-content">
                <div id="ocr-result-text" class="ocr-result-text"></div>
                <div class="ocr-result-actions">
                    <button id="copy-result-btn" class="action-btn" aria-label="è¤‡è£½è­˜åˆ¥çµæœ">
                        ğŸ“‹ è¤‡è£½
                    </button>
                </div>
            </div>
        </section>

        <!-- æ•…äº‹çµæœé¡¯ç¤ºå€åŸŸ -->
        <section id="story-result-area" class="story-result-area" style="display: none;" aria-live="polite">
            <div class="story-result-header">
                <h3>ğŸ“– ç”Ÿæˆçš„æ•…äº‹</h3>
                <button id="story-result-close" class="close-btn" aria-label="é—œé–‰æ•…äº‹çµæœ">âœ•</button>
            </div>
            <div class="story-result-content">
                <div id="story-content" class="story-content"></div>
                <div class="story-result-actions">
                    <button id="read-story-aloud-btn" class="action-btn" aria-label="æœ—è®€æ•…äº‹">
                        ğŸ”Š æœ—è®€
                    </button>
                    <button id="copy-story-btn" class="action-btn" aria-label="è¤‡è£½æ•…äº‹">
                        ğŸ“‹ è¤‡è£½
                    </button>
                    <button id="send-story-to-chat-btn" class="action-btn" aria-label="ç™¼é€åˆ°å°è©±">
                        ğŸ’¬ ç™¼é€åˆ°å°è©±
                    </button>
                </div>
            </div>
        </section>



        <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
        <div id="loading-indicator" class="loading-indicator" style="display: none;" aria-live="polite">
            <div class="loading-spinner" aria-hidden="true"></div>
            <div class="loading-text">å°å®‰æ­£åœ¨è™•ç†ä¸­...</div>
        </div>

        <!-- Gemini AI èŠå¤©æ©Ÿå™¨äººç•Œé¢ -->
        <section class="chatbot-section">
            <div class="chat-container">
                <div class="chat-header">
                    <h1>Gemini AI èŠå¤©</h1>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <!-- èŠå¤©è¨Šæ¯å°‡åœ¨æ­¤è™•é¡¯ç¤º -->
                </div>
                <div class="chat-input">
                    <input type="text" id="user-input" placeholder="è¼¸å…¥æ‚¨çš„è¨Šæ¯...">
                    <button id="send-button">ç™¼é€</button>
                </div>
            </div>
        </section>

    </main>

    <!-- é é¢åº•éƒ¨ç‰ˆæœ¬è³‡è¨Š -->
    <footer class="app-footer" style="text-align: center; padding: 20px; background-color: #f8f9fa; border-top: 1px solid #dee2e6; margin-top: 40px;">
        <div class="version-info" style="font-size: 0.85em; color: #6c757d;">
            <div style="margin-bottom: 8px;">
                <strong id="app-name">è€èŠ±çœ¼æ•‘æ˜Ÿ</strong> v<span id="app-version">1.2.1</span>
                <span style="font-size: 0.8em; color: #9ca3af;">(å»ºç½®: <span id="build-date">2025-01-08</span>)</span>
            </div>
            <div style="font-size: 0.8em; margin-bottom: 8px;">
                æ¨¡çµ„ç‰ˆæœ¬:
                <span id="module-versions">
                    Gemini Chat v<span id="gemini-version">1.2.1</span> |
                    OCR è™•ç†å™¨ v<span id="ocr-version">1.2.1</span> |
                    ä¸»æ‡‰ç”¨ v<span id="main-version">1.2.1</span> |
                    æ—¥èªŒç³»çµ± v<span id="logger-version">1.2.1</span>
                </span>
            </div>
            <div style="font-size: 0.75em; margin-bottom: 8px;">
                åŠŸèƒ½æ¨¡çµ„: <span id="features-list">è¼‰å…¥ä¸­...</span>
            </div>
            <div style="font-size: 0.75em; color: #9ca3af;">
                Â© 2025 è€èŠ±çœ¼æ•‘æ˜Ÿ - å°ˆç‚ºé•·è€…è¨­è¨ˆçš„æ™ºæ…§åŠ©æ‰‹
                <button id="show-diagnostics" style="margin-left: 10px; padding: 2px 8px; font-size: 0.7em; background: #e9ecef; border: 1px solid #dee2e6; border-radius: 3px; cursor: pointer;" title="é¡¯ç¤ºç³»çµ±è¨ºæ–·è³‡è¨Š">è¨ºæ–·</button>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script type="module">
        // æ‰€æœ‰æ¨¡çµ„å·²è‡ªå‹•è¼‰å…¥ .env é…ç½®ä¸¦åˆå§‹åŒ–
    </script>

    <!-- ç‰ˆæœ¬è³‡è¨Šæ›´æ–°è…³æœ¬ -->
    <script>
        // æ›´æ–°ç‰ˆæœ¬é¡¯ç¤º
        function updateVersionDisplay() {
            if (window.APP_CONFIG) {
                // æ›´æ–°åŸºæœ¬è³‡è¨Š
                document.getElementById('app-name').textContent = window.APP_CONFIG.APP_NAME || 'è€èŠ±çœ¼æ•‘æ˜Ÿ';
                document.getElementById('app-version').textContent = window.APP_CONFIG.APP_VERSION || '1.0.0';
                document.getElementById('build-date').textContent = window.APP_CONFIG.BUILD_DATE || 'æœªçŸ¥';

                // æ›´æ–°æ¨¡çµ„ç‰ˆæœ¬
                const versions = window.APP_CONFIG.MODULE_VERSIONS || {};
                document.getElementById('gemini-version').textContent = versions.gemini_chat || '1.0.0';
                document.getElementById('ocr-version').textContent = versions.ocr_processor || '1.0.0';
                document.getElementById('main-version').textContent = versions.main_app || '1.0.0';
                document.getElementById('logger-version').textContent = versions.logger || '1.0.0';

                // æ›´æ–°åŠŸèƒ½åˆ—è¡¨
                const features = window.APP_CONFIG.FEATURES || [];
                document.getElementById('features-list').textContent = features.join('ã€') || 'è¼‰å…¥ä¸­...';

                // è¨­å®šè¨ºæ–·æŒ‰éˆ•
                setupDiagnosticsButton();
            }
        }

        // è¨­å®šè¨ºæ–·æŒ‰éˆ•åŠŸèƒ½
        function setupDiagnosticsButton() {
            const diagnosticsBtn = document.getElementById('show-diagnostics');
            if (diagnosticsBtn) {
                diagnosticsBtn.addEventListener('click', function() {
                    showDiagnostics();
                });
            }
        }

        // é¡¯ç¤ºç³»çµ±è¨ºæ–·è³‡è¨Š
        function showDiagnostics() {
            if (window.logger && window.logger.diagnose) {
                const diagnosis = window.logger.diagnose();

                // é¡¯ç¤ºè©³ç´°è¨ºæ–·è³‡è¨Š
                console.log('=== ç³»çµ±è¨ºæ–·å ±å‘Š ===');
                console.log('ç‰ˆæœ¬è³‡è¨Š:', window.APP_CONFIG.getFullVersionInfo());
                console.log('åŠŸèƒ½ç‹€æ…‹:', window.APP_CONFIG.FEATURES_ENABLED);
                console.log('æ•ˆèƒ½è¨­å®š:', window.APP_CONFIG.PERFORMANCE);

                // é¡¯ç¤ºæ—¥èªŒçµ±è¨ˆ
                if (window.logger.showLogSummary) {
                    window.logger.showLogSummary();
                }

                alert(`ç³»çµ±è¨ºæ–·å®Œæˆï¼\n\nç‰ˆæœ¬: ${window.APP_CONFIG.APP_VERSION}\nå»ºç½®æ—¥æœŸ: ${window.APP_CONFIG.BUILD_DATE}\n\nè©³ç´°è³‡è¨Šè«‹æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å° (F12)`);
            } else {
                alert('æ—¥èªŒç³»çµ±å°šæœªè¼‰å…¥ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œæ›´æ–°ç‰ˆæœ¬è³‡è¨Š
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶é²åŸ·è¡Œä»¥ç¢ºä¿é…ç½®å·²è¼‰å…¥
            setTimeout(updateVersionDisplay, 100);
        });

        // å¦‚æœé…ç½®å¾Œè¼‰å…¥ï¼Œä¹Ÿè¦æ›´æ–°ç‰ˆæœ¬
        window.addEventListener('load', function() {
            setTimeout(updateVersionDisplay, 500);
        });

        // ç›£è½é…ç½®è¼‰å…¥äº‹ä»¶
        window.addEventListener('APP_CONFIG_LOADED', updateVersionDisplay);
    </script>
</body>
</html>
