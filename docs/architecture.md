# 老花眼救星 專案架構文件

## 1. 系統架構概覽
本系統採用微服務架構，分為前端介面、後端服務與第三方 API 整合三個主要層次。核心邏輯由後端服務處理，透過 API 與前端介面進行通訊，並調用外部 LLM 與 OCR 服務。

## 2. 技術棧 (Technical Stack)
* **前端 (Frontend)**：
    * 框架：考慮使用 React 或 Vue.js，以實現組件化、高效能的單頁應用程式（SPA）。
    * UI/UX：專注於極簡設計、大字體、高對比，所有按鈕和元素都必須符合無障礙設計規範。
    * 功能：負責處理使用者上傳、介面顯示、語音輸入（STT）以及語音朗讀（TTS）的播放。新增 **「上傳圖片辨識是否詐騙」** 專屬按鈕。

* **後端 (Backend)**：
    * 語言/框架：Python with FastAPI/Flask，或 Node.js with Express，以實現輕量級、高效能的 API 服務。
    * **核心模組**：
        1.  **文件處理模組**：接收前端上傳的圖片。
        2.  **OCR 服務模組**：處理圖片的文字辨識。**注意：當使用者使用專屬防詐按鈕上傳時，此模組將被跳過。如果 OCR 失敗或超過 180 秒，則自動觸發故事生成器。**
        3.  **LLM 整合模組**：
            * **故事生成器**：調用 **Gemini Flash 2.0**，根據 `content` 和「小安」的 prompt 生成口語化故事（`story`）。在 OCR 失敗時，自動隨機生成故事。
            * **聊天機器人**：調用 **Gemini Flash 2.0**，處理使用者輸入的問題，並根據當前 AI 角色（小安/智能醫師/智能防詐警察）的 prompt 進行回覆。
        4.  **角色判斷模組**：一個輕量級的 AI 模型或關鍵詞篩選器，用於快速判斷 OCR 結果或**使用者輸入**是否為藥品、保健品或詐騙相關內容，並觸發角色切換邏輯。
    * **語音模組**：調用外部 TTS 服務，將文字轉化為音頻檔，供前端播放。

## 3. 數據流程 (Data Flow)
1.  使用者在前端介面點擊「上傳照片」（一般模式）或「上傳圖片辨識是否詐騙」（防詐專屬模式）。
2.  後端接收圖片。
    * **一般模式**：圖片傳送給 OCR 服務，接收 `content` 文字。
    * **防詐專屬模式**：後端直接將圖片發送到「角色判斷模組」進行關鍵詞篩選，**繞過 OCR**。
3.  後端將 `content` 或使用者輸入傳送給「角色判斷模組」。
4.  **如果非藥品/保健品/詐騙**：`content` 傳送給「故事生成器」，生成 `story`，並由「小安」的 prompt 驅動聊天機器人進行回應。
5.  **如果為藥品/保健品**：後端直接觸發「智能醫師」的固定腳本，並將回應文字傳送給前端。
6.  **如果為詐騙**：後端直接觸發「智能防詐警察」的固定腳本，並將回應文字傳送給前端。
7.  前端將收到的文字顯示在對話框中。
8.  當使用者點擊「大聲朗讀」時，前端將文字發送給後端，後端調用 TTS 服務生成音頻，再將其回傳給前端播放。
