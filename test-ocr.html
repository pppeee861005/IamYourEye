<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCRæ¸¬è©¦é é¢</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
    </style>
</head>
<body>
    <h1>OCRåŠŸèƒ½æ¸¬è©¦</h1>

    <div>
        <h2>æ¸¬è©¦1: åŸºæœ¬OCRåŠŸèƒ½</h2>
        <button onclick="testBasicOCR()">é‹è¡ŒåŸºæœ¬OCRæ¸¬è©¦</button>
        <div id="basic-test-result" class="test-result"></div>
    </div>

    <div>
        <h2>æ¸¬è©¦2: ä¸­æ–‡è­˜åˆ¥æ¸¬è©¦</h2>
        <button onclick="testChineseOCR()">é‹è¡Œä¸­æ–‡OCRæ¸¬è©¦</button>
        <div id="chinese-test-result" class="test-result"></div>
    </div>

    <div>
        <h2>æ¸¬è©¦3: ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
        <button onclick="checkSystemStatus()">æª¢æŸ¥ç³»çµ±ç‹€æ…‹</button>
        <div id="status-result" class="test-result"></div>
    </div>

    <script>
        // å‰µå»ºæ¸¬è©¦åœ–ç‰‡çš„å‡½æ•¸
        function createTestImage(text, width = 300, height = 100) {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            // è¨­ç½®ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, width, height);

            // è¨­ç½®æ–‡å­—æ¨£å¼
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';

            // ç¹ªè£½æ–‡å­—
            ctx.fillText(text, 10, 10);

            return canvas.toDataURL('image/png');
        }

        // åŸºæœ¬OCRæ¸¬è©¦
        async function testBasicOCR() {
            const resultDiv = document.getElementById('basic-test-result');
            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
            resultDiv.className = 'test-result';

            try {
                // å‰µå»ºæ¸¬è©¦åœ–ç‰‡
                const testImage = createTestImage('Hello World 123');

                // åŸ·è¡ŒOCR
                const result = await Tesseract.recognize(testImage, 'eng', {
                    logger: m => console.log(m)
                });

                const extractedText = result.data.text.trim();
                const confidence = result.data.confidence;

                resultDiv.innerHTML = `
                    <div class="success">
                        <h3>âœ… åŸºæœ¬OCRæ¸¬è©¦æˆåŠŸ</h3>
                        <p><strong>è­˜åˆ¥æ–‡å­—:</strong> "${extractedText}"</p>
                        <p><strong>ä¿¡å¿ƒåº¦:</strong> ${confidence}%</p>
                        <p><strong>æ¸¬è©¦åœ–ç‰‡æ–‡å­—:</strong> "Hello World 123"</p>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ åŸºæœ¬OCRæ¸¬è©¦å¤±æ•—</h3>
                        <p><strong>éŒ¯èª¤è¨Šæ¯:</strong> ${error.message}</p>
                    </div>
                `;
                resultDiv.className = 'test-result error';
            }
        }

        // ä¸­æ–‡OCRæ¸¬è©¦
        async function testChineseOCR() {
            const resultDiv = document.getElementById('chinese-test-result');
            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
            resultDiv.className = 'test-result';

            try {
                // å‰µå»ºä¸­æ–‡æ¸¬è©¦åœ–ç‰‡
                const testImage = createTestImage('é€™æ˜¯æ¸¬è©¦æ–‡å­—');

                // åŸ·è¡ŒOCR
                const result = await Tesseract.recognize(testImage, 'chi_tra', {
                    logger: m => console.log(m)
                });

                const extractedText = result.data.text.trim();
                const confidence = result.data.confidence;

                resultDiv.innerHTML = `
                    <div class="success">
                        <h3>âœ… ä¸­æ–‡OCRæ¸¬è©¦æˆåŠŸ</h3>
                        <p><strong>è­˜åˆ¥æ–‡å­—:</strong> "${extractedText}"</p>
                        <p><strong>ä¿¡å¿ƒåº¦:</strong> ${confidence}%</p>
                        <p><strong>æ¸¬è©¦åœ–ç‰‡æ–‡å­—:</strong> "é€™æ˜¯æ¸¬è©¦æ–‡å­—"</p>
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ ä¸­æ–‡OCRæ¸¬è©¦å¤±æ•—</h3>
                        <p><strong>éŒ¯èª¤è¨Šæ¯:</strong> ${error.message}</p>
                    </div>
                `;
                resultDiv.className = 'test-result error';
            }
        }

        // ç³»çµ±ç‹€æ…‹æª¢æŸ¥
        function checkSystemStatus() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.className = 'test-result success';

            const status = {
                tesseractAvailable: typeof Tesseract !== 'undefined',
                tesseractVersion: Tesseract ? Tesseract.version : 'æœªçŸ¥',
                userAgent: navigator.userAgent,
                language: navigator.language,
                online: navigator.onLine,
                cookieEnabled: navigator.cookieEnabled
            };

            resultDiv.innerHTML = `
                <h3>ğŸ“Š ç³»çµ±ç‹€æ…‹æª¢æŸ¥çµæœ</h3>
                <ul>
                    <li><strong>Tesseract.js å¯ç”¨:</strong> ${status.tesseractAvailable ? 'âœ…' : 'âŒ'}</li>
                    <li><strong>Tesseract.js ç‰ˆæœ¬:</strong> ${status.tesseractVersion}</li>
                    <li><strong>ç€è¦½å™¨:</strong> ${status.userAgent.split(' ').pop()}</li>
                    <li><strong>èªè¨€:</strong> ${status.language}</li>
                    <li><strong>ç¶²è·¯é€£ç·š:</strong> ${status.online ? 'âœ…' : 'âŒ'}</li>
                    <li><strong>Cookies å•Ÿç”¨:</strong> ${status.cookieEnabled ? 'âœ…' : 'âŒ'}</li>
                </ul>
            `;
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•æª¢æŸ¥ç³»çµ±ç‹€æ…‹
        window.addEventListener('load', function() {
            checkSystemStatus();
        });
    </script>
</body>
</html>
